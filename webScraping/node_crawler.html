<!DOCTYPE html>
<html>
<head>
	<title>node采集网络数据</title>
	<meta charset="utf-8">
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
	<link rel="stylesheet" type="text/css" href="../css/index.css">
</head>
<body>
<header>
	<div class="info">
		<div class="blog-photo"><img src="../images/me.jpg"></div>
		<div class="blog-intro">
			<p class="blog-name">初木禾君</p>
			<p class="blog-university">Tianjin University</p>
		</div>
	</div>
</header>

<div class="container">
	<h1>利用node和cheerio采集网络数据</h1>

<article>
		<h2>测试node爬虫的可用性</h2>
		<p>
			<pre>
#nodeServer.js
var http = require("http");
 
// Utility function that downloads a URL and invokes
// callback with the data.
function download(url, callback) {
  http.get(url, function(res) {
    var data = "";
    res.on('data', function (chunk) {
      data += chunk;
    });
    res.on("end", function() {
      callback(data);
    });
  }).on("error", function() {
    callback(null);
  });
}
 
exports.download = download; 



#node_crawler.js
var cheerio = require("cheerio");

var server = require("./nodeServer");
 
var url = "http://v.163.com/special/opencourse/englishs1.html"
 
server.download(url, function(data) {
  if (data) {
    //console.log(data);
 
    var $ = cheerio.load(data);
    $("a.downbtn").each(function(i, e) {
        console.log($(e).attr("href"));
    });
 
    console.log("done");
  } else {
      console.log("error");
  } 
}); 
			</pre>
		</p>
	</article>
	<article>
		<h2>获取慕课网node视频教程的标题</h2>
		<p>
			<pre>
var http = require('http');
var cheerio = require('cheerio');
var url = 'http://www.imooc.com/learn/348';
function filter(html){
	var $ = cheerio.load(html);
	var chapters = $('.chapter');
	var courseData = [];

	chapters.each(function(item){
		var chapter = $(this);
		var chapterTitle = chapter.find('strong').text();
		var videos = chapter.find('.video').children('li');
		var chapterData = {
			chapterTitle: chapterTitle,
			videos:[],
		};
		videos.each(function(item){
			var video = $(this).find('.studyvideo');
			var videoTitle = video.text();
			var id = video.attr('href').split('video/')[1];
			chapterData.videos.push({
				title:videoTitle,
				id: id
			});
		});
		courseData.push(chapterData);

	});
	return courseData;
}
function printCourseInfo(course){
	course.forEach(function(item){
		var chapterTitle = item.chapterTitle;
		console.log(chapterTitle+'\n');
		item.videos.forEach(function(video){
			console.log(' ['+video.id+']'+video.title+'\n');
		});
	});
}
http.get(url,function(res){
	var html=' ';

	res.on('data',function(data){
		html+=data;
	});
	res.on('end',function(){
		var courseData = filter(html);
		console.log('success');
		printCourseInfo(courseData);
	});
}).on('error',function(){
	console.log('something wrong happen');
});
			</pre>
		</p>
	</article>
</body>
</html>